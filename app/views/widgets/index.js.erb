var render;
/* Save current tab to display the same tab after entering the search */
var currentTab = $('#nav-tabContent > .show.active').attr('id');
/* Save current sort to display the same sort after entering the search */
var currentSort = $('a label.active').text().replace(/\s/g,'');
switch(currentSort) {
    case "Org-Unit":
        render = "<%= escape_javascript(render partial: 'sort_by_org_units', locals: {widgets: @widgets, buttons: @buttons }) %>";
        break;
    case "Ort":
    case "Location":
        render = "<%= escape_javascript(render partial: 'sort_by_locations', locals: {widgets: @widgets, buttons: @buttons }) %>";
        break;
    case "A-Z":
        render = "<%= escape_javascript(render partial: 'sort_alphabetically', locals: {widgets: @widgets, buttons: @buttons }) %>";
        break;
    case "Z-A":
        render = "<%= escape_javascript(render partial: 'sort_alphabetically', locals: {widgets: @widgets, buttons: @buttons }) %>";
}
/* Positioning the rendered partial */
$('#widgets_card').html(render);
/* Remove class of current tab in card-header */
$('#widgets_card > .card-header > ul#nav-tab > li.nav-item > .nav-link.active').removeClass('active');
$('#widgets_card > .card-header > ul#nav-tab-responsive > li > .nav-link.active').removeClass('active');
if ($('#' + currentTab + '-tab').length > 0)
{
    /* Add class active if there exists the same tab as before */
    $('ul#nav-tab > li > #' + currentTab + "-tab").addClass('active');
    $('ul#nav-tab-responsive > li > #' + currentTab + "-tab").addClass('active');
}
else
{
    /* Else add class active to the first tab */
    $('#nav-tab > .nav-item > .nav-link').first().addClass('active');
}
/* Remove class of current tab in card-body */
$('.tab-content > .tab-pane.fade.show.active').removeClass('show active');
if ($('#' + currentTab).length > 0)
{
    /* Add class active if there exists the same tab as before */
    $('#' + currentTab).addClass('show active');
}
else
{
    /* Else add class active to the first tab */
    $('#widgets_card > .card-body > .tab-content > .tab-pane.fade').first().addClass('show active');
}

/* Open first entry in every tab */
var array = $('#widgets_card > .card-body > .tab-content > .tab-pane.fade > .accordion').map(function() {
    return this.id;
}).get();
$.each(array, function( index, value ) {
    /* Turn first triangle */
    $('#' + value + ' > div > div > .row > .col > .mb-0 > button > span').first()
        .removeClass('glyphicon-triangle-right').addClass('glyphicon-triangle-bottom');
    /* Show first content */
    $('#' + value + ' > div > .collapse').first().addClass('show');
});

/* Activate all toggles */
$(':checkbox').bootstrapToggle();
